<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:replace="~{fragments/header :: head}">
    <meta charset="UTF-8">
    <title>Ratings</title>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<h1 th:text="#{ratings.rateFilm}"></h1>
<h2 th:text="${film.getTitle()}"></h2>
<form id="rateForm" data-film-id="${film.id}" onsubmit="submitRating(); return false;">
        <div>
            <label><input type="radio" value="1" name="score">1</label>
            <label><input type="radio" value="2" name="score">2</label>
            <label><input type="radio" value="3" name="score">3</label>
            <label><input type="radio" value="4" name="score">4</label>
            <label><input type="radio" value="5" name="score">5</label>
        </div>
    <input type="submit" th:value="#{common.submit}">
</form>

<script>
    function submitRating() {
        const score = document.getElementById("score").value;
        const filmId = document.getElementById("rateForm").dataset.filmId;

        fetch("/api/ratings", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                score: score,
                film: { id: filmId },
                user: { id: 1 }  // temporal mientras implementas login
            })
        })
        .then(response => {
            if (!response.ok) throw new Error("Error saving rating");
            window.location.href = "/films"; // redirige a lista
        })
        .catch(error => alert(error));
    }
</script>

<div th:replace="~{fragments/footer :: footer}"></div>
<div th:replace="~{fragments/header :: scripts}"></div>
</body>
</html>